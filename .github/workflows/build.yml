name: SonarQube Scan

on:
  push:
    branches:
      - main
  

jobs:
  sonarQubeScan:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'adopt'
        cache: 'maven'

    - name: Download SonarQube Scanner
      run: |
        curl -sSLo sonarqube-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472-windows.zip
        Expand-Archive sonarqube-scanner.zip -DestinationPath $env:GITHUB_WORKSPACE
        Move-Item $env:GITHUB_WORKSPACE\sonar-scanner-* $env:GITHUB_WORKSPACE\sonar-scanner

    - name: Run SonarQube scan
      run: |
        $env:PATH = "$env:GITHUB_WORKSPACE\sonar-scanner\bin;$env:PATH"
        sonar-scanner.bat -Dsonar.organization=SonarQubeDemo -Dsonar.projectKey=SonarQubeDemo_CodeQualityCheck_8754f4b7-ec30-4fcb-9dc9-9dc040e9b7a8 -Dsonar.host.url=%SONAR_HOST_URL% -Dsonar.login=%SONAR_TOKEN%
      env:
        SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
